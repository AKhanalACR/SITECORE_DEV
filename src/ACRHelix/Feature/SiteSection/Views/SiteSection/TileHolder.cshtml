@using PagedList.Mvc;
@inherits Glass.Mapper.Sc.Web.Mvc.GlassView<ACRHelix.Feature.SiteSection.ViewModels.TileHolderViewModel>
@using ACRHelix.Foundation.EditFrames;
@using ACRHelix.Feature.SiteSection.Constants;

@if (Sitecore.Context.PageMode.IsExperienceEditor)
{
    var width = Model.TileCssClass.Contains("xl-col-4") ? "33.33%;" : "25%;";

    <style type="text/css">
        .tile-holder div.scLooseFrameZone {
            width: @width
        }
            .tile-holder div.scLooseFrameZone .xl-col-3 {
                width: 100%;
            }
    </style>
}

<!--start: Module -->
<section class="content section-spacing" style="min-height:100px">
    @if (Model.Title != "" || Sitecore.Context.PageMode.IsExperienceEditorEditing)
    {
        <h2>@Editable(x => x.Title)</h2>
        <hr>
    }
    <div class="fluid-tiles row flex-container text-center tile-holder">
        @*<a href="#" class="button" onclick="javascript:Sitecore.PageModes.PageEditor.postRequest('webedit:new(id=@(Model.Id))')">Manage Tiles</a>*@

        @if (Model.Tiles != null && Model.Tiles.Count() > 0)
        {
            var style = "";
            if (Sitecore.Context.PageMode.IsExperienceEditor)
            {
                style = "width:100%";
            }

            foreach (var tile in Model.Tiles)
            {
                var editFramePath = tile.TemplateID == TileConstants.Templates.ExternalTileTemplate.ID ? EditFrameConstants.Paths.Tile_Edit_External : EditFrameConstants.Paths.Tile_Edit;
                bool hasImage = tile.Image != null && tile.Image.Src != "";
                using (BeginEditFrame(editFramePath, tile.Id.ToString(), "Tile Holder"))
                {
                    <div class="@Model.TileCssClass" style="@style">
                        <div class="fluid-tile @(!hasImage ? "fluid-tile-no-image" : "")">
                            <header class="fluid-header header-bottom-zero">
                                <h3>
                                    @if (tile.TemplateID == TileConstants.Templates.ExternalTileTemplate.ID)
                                    {
                                        using (BeginRenderLink(tile, x => x.Link, new System.Collections.Specialized.NameValueCollection { { "class", "read-more-link" } }, isEditable: true))
                                        {
                                            @Editable(tile, x => x.LinkText)
                                        }
                                    }
                                    else
                                    {
                                        <a class="read-more-link" href="@tile.Url">@Editable(tile, x => x.Title)</a>
                                    }

                                </h3>
                            </header>
                            @if (hasImage)
                            {
                                <figure>
                                    @if (tile.TemplateID == TileConstants.Templates.ExternalTileTemplate.ID)
                                    {
                                        using (BeginRenderLink(tile, x => x.Link, new System.Collections.Specialized.NameValueCollection { { "class", "block" } }, isEditable: true))
                                        {
                                            @Editable(tile, x => x.Image)
                                        }
                                    }
                                    else
                                    {
                                        <a href="@tile.Url" class="block">
                                            @Editable(tile, x => x.Image)
                                        </a>
                                    }
                                </figure>
                            }
                            else
                            {
                                if (tile.TemplateID == TileConstants.Templates.ExternalTileTemplate.ID)
                                {
                                    <div class="text-content text-left">
                                        @using (BeginRenderLink(tile, x => x.Link, new System.Collections.Specialized.NameValueCollection { { "class", "block" } }, isEditable: true))
                                        {
                                            @Editable(tile, x => x.TileText)
                                        }
                                    </div>
                                    using (BeginRenderLink(tile, x => x.Link, new System.Collections.Specialized.NameValueCollection { { "class", "tile-bottom-link read-more-link" } }, isEditable: true))
                                    {
                                        @Editable(tile, x => x.LinkText)
                                    }
                                }
                                else
                                {
                                    <div class="text-content text-left">
                                        <a class="block" href="@tile.Url">@Editable(tile, x => x.TileText)</a>
                                    </div>
                                    <a href="@tile.Url" class="tile-bottom-link read-more-link" tabindex="0">@Editable(tile, x => x.LinkText)</a>
                                }
                            }
                        </div>
                    </div>
                }
            }

            for (int i = 0; i < Model.HiddenTiles; i++)
            {
                <div class="@Model.TileCssClass" style="@style"></div>
            }
        }
                </div>

    @if (Model.PageCount > 1)
    {
        <div class="indented-section section-spacing">
            <div class="search-pager-nav">
                @{
                    var nameValues = HttpUtility.ParseQueryString(Request.QueryString.ToString());
                    string url = Request.Url.AbsolutePath;
                }

                @if (Model.PageNumber > 1)
                {
                    nameValues.Set("page", (Model.PageNumber - 1).ToString());
                    <a href="@(url + "?" + nameValues)"><div class="slick-prev slick-arrow" aria-label="Previous" role="button"></div></a>
                }
                <form action="@(url)" method="get">
                    <div class="slick-custom-pager" role="toolbar">
                        @foreach (var value in nameValues)
                        {
                            if (value as string != "page")
                            {
                                <input type="hidden" name="@value" class="slide-num-input" data-prev-val="1" value="@nameValues[value as string]">
                            }
                        }
                        <input name="page" class="slide-num-input" data-prev-val="1" value="@Model.PageNumber" type="text">of @Model.PageCount
                    </div>
                </form>
                @if (Model.PageNumber < Model.PageCount)
                {
                    nameValues.Set("page", (Model.PageNumber + 1).ToString());
                    <a href="@(url + "?" + nameValues)"><div class="slick-next slick-arrow" aria-label="Next" role="button"></div></a>
                }
            </div>
        </div>
                    }

</section>